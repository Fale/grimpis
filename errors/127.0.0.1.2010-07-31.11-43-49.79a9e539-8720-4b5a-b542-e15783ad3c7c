(dp1
S'output'
p2
S''
sS'layer'
p3
S'/home/web2py/applications/isys/models/dbs.py'
p4
sS'code'
p5
S'# coding: utf8\nfrom applications.isys.modules.states import *\n\nis_phone = IS_MATCH(\'^(\\+\\d{2}\\-)?[\\d\\-]*(\\#\\d+)?$\')\n\ntry:\n    db=DAL("sqlite://db.db")\nexcept:\n    db=DAL(\'gae\')\n    session.connect(request,response,db=db)\n\ndb.define_table(\'clients\',\n    Field(\'name\'),\n    Field(\'piva\'),\n    Field(\'email\'),\n    Field(\'address_num\'),\n    Field(\'address_road\'),\n    Field(\'address_city\'),\n    Field(\'address_county\'),\n    Field(\'address_zip\'),\n    Field(\'address_state\'),\n    Field(\'mobile\'),\n    Field(\'phone\'),\n    Field(\'fax\'))\n    \ndb.clients.name.label=T("Name")\ndb.clients.name.requires=[IS_NOT_EMPTY(),IS_NOT_IN_DB(db,\'clients.name\')]\ndb.clients.piva.label=T("P IVA")\ndb.clients.piva.requires=IS_NOT_EMPTY()\ndb.clients.email.label=T("E-Mail")\ndb.clients.address_num.label=T("Number")\ndb.clients.address_road.label=T("Street")\ndb.clients.address_city.label=T("City")\ndb.clients.address_county.label=T("County")\ndb.clients.address_zip.label=T("ZIP Code")\ndb.clients.address_state.label=T("State")\ndb.clients.address_state.requires = IS_IN_SET(STATES)\ndb.clients.mobile.label=T("Mobile")\ndb.clients.mobile.requires=is_phone\ndb.clients.phone.label=T("Phone")\ndb.clients.phone.requires=is_phone\ndb.clients.fax.label=T("Fax")\ndb.clients.fax.requires=is_phone\n\n\n\ndb.define_table(\'works\',\n    Field(\'name\',\'text\'),\n    Field(\'client\',db.client),\n    Field(\'description\',\'text\'),\n    Field(\'assign_date\',\'date\'),\n    Field(\'due_to_date\',\'date\'),\n    Field(\'value\',\'integer\'),\n    Field(\'cost\',\'integer\'))\n    \ndb.works.name.label=T("Name")\ndb.works.client.label=T("Client")\ndb.works.client.requires=IS_IN_DB(db,\'clients.id\',\'clients.name\')\ndb.works.description.label=T("description")\ndb.works.assign_date.label=T("Assigned")\ndb.works.due_to_date.label=T("Due To")\ndb.works.value.label=T("Value")\ndb.works.cost.label=T("Cost")\n\n\ndb_invoice = DAL(\'sqlite://invoice.sqlite\')\n\ndb_invoice.define_table(\'customer\',\n                       Field(\'name\',\'string\'),\n                       Field(\'vat_code\',\'string\')\n                       )\n\n\ndb_invoice.define_table(\'payment_type\',\n                       Field(\'name\',\'string\'),\n                       Field(\'days\',\'integer\'),\n                       Field(\'end_of_month\',\'boolean\')\n                       )\ndb_invoice.define_table(\'invoice\',\n                       Field(\'code\',\'string\'),\n                       Field(\'customer\',db_invoice.customer),\n                       Field(\'created_on\',\'datetime\'),\n                       Field(\'emitted_on\',\'date\'),\n                       Field(\'emitted_at\',\'time\'),\n                       Field(\'emitted\',\'boolean\'),\n                       Field(\'remarks\',\'text\'),\n                       Field(\'total_amount\',\'double\'),\n                       Field(\'tax_percentage\',\'integer\')\n                       )\ndb_invoice.invoice.customer.requires=IS_IN_DB(db_invoice,\'customer.id\',\'customer.name\')\n'
p6
sS'traceback'
p7
S'Traceback (most recent call last):\n  File "/home/web2py/gluon/restricted.py", line 178, in restricted\n    exec ccode in environment\n  File "/home/web2py/applications/isys/models/dbs.py", line 49, in <module>\n    Field(\'client\',db.client),\n  File "/home/web2py/gluon/sql.py", line 1329, in __getattr__\n    return dict.__getitem__(self,key)\nKeyError: \'client\'\n'
p8
s.